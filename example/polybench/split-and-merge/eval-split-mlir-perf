#!/usr/bin/env bash


set -o errexit
set -o pipefail
set -o nounset


function perf_count() {
  local cmd="$1"
  local perf_result
  perf_result="$(perf stat -e cycles,instructions,branches,branch-misses,cache-references,cache-misses,bus-cycles,L1-dcache-loads,L1-dcache-load-misses,L1-dcache-stores,dTLB-loads,dTLB-load-misses,LLC-loads,LLC-load-misses,LLC-stores,cycle_activity.stalls_mem_any taskset -c 1-8 numactl -a "${cmd}")"

  echo "${perf_result}"
}

DIR="$1"

perf_count "${DIR}/2mm/2mm.nosplit.polymer.seq.exe"
perf_count "${DIR}/2mm/2mm.heuristic.polymer.seq.exe"
perf_count "${DIR}/3mm/3mm.nosplit.polymer.seq.exe"
perf_count "${DIR}/3mm/3mm.heuristic.polymer.seq.exe"
perf_count "${DIR}/correlation/correlation.nosplit.polymer.seq.exe"
perf_count "${DIR}/correlation/correlation.heuristic.polymer.seq.exe"
perf_count "${DIR}/covariance/covariance.nosplit.polymer.seq.exe"
perf_count "${DIR}/covariance/covariance.heuristic.polymer.seq.exe"
perf_count "${DIR}/trmm/trmm.nosplit.polymer.seq.exe"
perf_count "${DIR}/trmm/trmm.heuristic.polymer.seq.exe"
